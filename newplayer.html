<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é€šç”¨åª’ä½“æ’­æ”¾å™¨</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¬</text></svg>">
  
  <!-- Video.js CSS for enhanced player -->
  <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
  
  <!-- HLS.js for m3u8 support -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  
  <!-- Video.js for enhanced controls -->
  <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 
                   'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: #fff;
    }

    .container {
      width: 100%;
      max-width: 1400px;
      background: rgba(0, 0, 0, 0.85);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .header {
      padding: 30px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header p {
      color: rgba(255, 255, 255, 0.7);
      font-size: 14px;
    }

    .url-input-section {
      padding: 30px;
      background: rgba(255, 255, 255, 0.05);
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    .input-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .url-input {
      flex: 1;
      min-width: 300px;
      padding: 14px 20px;
      font-size: 15px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      outline: none;
      transition: all 0.3s ease;
    }

    .url-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .url-input:focus {
      border-color: #667eea;
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
    }

    .load-btn {
      padding: 14px 32px;
      font-size: 15px;
      font-weight: 600;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .load-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    .load-btn:active {
      transform: translateY(0);
    }

    .player-container {
      position: relative;
      width: 100%;
      background: #000;
    }

    #video-player {
      width: 100%;
      height: auto;
      max-height: 80vh;
      display: block;
    }

    /* Enhanced Video.js styling */
    .video-js {
      font-family: inherit;
    }

    .video-js .vjs-control-bar {
      background: linear-gradient(to top, rgba(0, 0, 0, 0.95), rgba(0, 0, 0, 0.7));
      height: 4.5em;
      display: flex;
      font-size: 15px;
    }

    .video-js .vjs-big-play-button {
      width: 3em;
      height: 3em;
      line-height: 3em;
      border-radius: 50%;
      background: rgba(102, 126, 234, 0.95);
      border: 3px solid rgba(255, 255, 255, 0.9);
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      transition: all 0.3s ease;
      font-size: 2em;
    }

    .video-js .vjs-big-play-button:hover {
      background: #667eea;
      transform: translate(-50%, -50%) scale(1.1);
      box-shadow: 0 0 30px rgba(102, 126, 234, 0.6);
    }

    .video-js .vjs-play-progress {
      background: linear-gradient(90deg, #667eea, #764ba2);
    }

    .video-js .vjs-volume-level {
      background: linear-gradient(90deg, #667eea, #764ba2);
    }

    .video-js .vjs-slider {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .video-js .vjs-load-progress {
      background: rgba(255, 255, 255, 0.3);
    }

    .video-js .vjs-progress-control {
      position: absolute;
      bottom: 4em;
      width: 100%;
      height: 0.8em;
    }

    .video-js .vjs-progress-holder {
      height: 0.8em;
    }

    .video-js .vjs-control:hover::before,
    .video-js .vjs-control:focus::before {
      color: #667eea;
      text-shadow: 0 0 10px rgba(102, 126, 234, 0.8);
    }

    .video-js .vjs-time-control {
      min-width: 3.5em;
      padding: 0 0.5em;
      font-size: 1.1em;
    }

    .video-js .vjs-volume-panel {
      order: 3;
    }

    .video-js .vjs-fullscreen-control {
      order: 4;
      font-size: 1.4em;
    }

    .info-section {
      padding: 25px 30px;
      background: rgba(255, 255, 255, 0.03);
      display: none;
    }

    .info-section.show {
      display: block;
    }

    .video-info {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
    }

    .video-info-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .video-info-item strong {
      color: #667eea;
    }

    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 14px;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 10000;
      border: 1px solid rgba(102, 126, 234, 0.5);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    .toast.show {
      opacity: 1;
    }

    .format-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 15px;
    }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      background: rgba(102, 126, 234, 0.2);
      border: 1px solid rgba(102, 126, 234, 0.4);
      border-radius: 6px;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.9);
    }

    .instructions {
      margin-top: 15px;
      padding: 15px;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 10px;
      font-size: 13px;
      line-height: 1.6;
      color: rgba(255, 255, 255, 0.8);
    }

    .instructions code {
      background: rgba(0, 0, 0, 0.3);
      padding: 2px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      color: #fff;
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 22px;
      }

      .input-group {
        flex-direction: column;
      }

      .url-input {
        min-width: 100%;
      }

      .load-btn {
        width: 100%;
      }

      .video-js .vjs-control-bar {
        font-size: 13px;
        height: 4em;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¬ é€šç”¨åª’ä½“æ’­æ”¾å™¨</h1>
      <p>æ”¯æŒ MP4ã€M3U8 (HLS)ã€WebMã€OGG ç­‰å¤šç§è§†é¢‘æ ¼å¼</p>
      <div class="format-badges">
        <span class="badge">MP4</span>
        <span class="badge">M3U8 / HLS</span>
        <span class="badge">WebM</span>
        <span class="badge">OGG</span>
        <span class="badge">MOV</span>
        <span class="badge">AVI</span>
      </div>
    </div>

    <div class="url-input-section">
      <div class="input-group">
        <input 
          type="text" 
          id="url-input" 
          class="url-input" 
          placeholder="è¾“å…¥è§†é¢‘åœ°å€æˆ–ä½¿ç”¨ ?url=è§†é¢‘åœ°å€ è‡ªåŠ¨åŠ è½½..."
        >
        <button id="load-btn" class="load-btn">â–¶ æ’­æ”¾è§†é¢‘</button>
      </div>
      <div class="instructions">
        <strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong><br>
        â€¢ ç›´æ¥åœ¨ä¸Šæ–¹è¾“å…¥æ¡†ç²˜è´´è§†é¢‘åœ°å€åç‚¹å‡»æ’­æ”¾<br>
        â€¢ æˆ–åœ¨ç½‘å€åæ·»åŠ å‚æ•°ï¼š<code>?url=https://example.com/video.mp4</code><br>
        â€¢ æ”¯æŒé”®ç›˜å¿«æ·é”®ï¼šç©ºæ ¼ï¼ˆæ’­æ”¾/æš‚åœï¼‰ã€â†â†’ï¼ˆå¿«é€€/å¿«è¿›ï¼‰ã€â†‘â†“ï¼ˆéŸ³é‡è°ƒèŠ‚ï¼‰ã€Fï¼ˆå…¨å±ï¼‰
      </div>
    </div>

    <div class="player-container">
      <video 
        id="video-player" 
        class="video-js vjs-big-play-centered" 
        controls 
        preload="auto"
        playsinline
      >
        <p class="vjs-no-js">
          è¦è§‚çœ‹æ­¤è§†é¢‘ï¼Œè¯·å¯ç”¨ JavaScript æˆ–å‡çº§åˆ°æ”¯æŒ HTML5 çš„æµè§ˆå™¨ã€‚
        </p>
      </video>
    </div>

    <div class="info-section" id="info-section">
      <div class="video-info">
        <div class="video-info-item">
          <strong>è§†é¢‘åœ°å€ï¼š</strong>
          <span id="current-url">-</span>
        </div>
        <div class="video-info-item">
          <strong>æ ¼å¼ï¼š</strong>
          <span id="video-format">-</span>
        </div>
        <div class="video-info-item">
          <strong>æ’­æ”¾çŠ¶æ€ï¼š</strong>
          <span id="play-status">å°±ç»ª</span>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // åˆå§‹åŒ–æ’­æ”¾å™¨
    const videoElement = document.getElementById('video-player');
    const urlInput = document.getElementById('url-input');
    const loadBtn = document.getElementById('load-btn');
    const infoSection = document.getElementById('info-section');
    const currentUrlSpan = document.getElementById('current-url');
    const videoFormatSpan = document.getElementById('video-format');
    const playStatusSpan = document.getElementById('play-status');
    
    let player = videojs('video-player', {
      controls: true,
      autoplay: false,
      preload: 'auto',
      fluid: false,
      responsive: true,
      playbackRates: [0.5, 0.75, 1, 1.25, 1.5, 2],
      controlBar: {
        children: [
          'playToggle',
          'currentTimeDisplay',
          'timeDivider',
          'durationDisplay',
          'progressControl',
          'volumePanel',
          'playbackRateMenuButton',
          'fullscreenToggle'
        ]
      }
    });

    let hlsInstance = null;

    // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
    function showToast(message, duration = 2000) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
    }

    // æ£€æµ‹è§†é¢‘æ ¼å¼
    function detectFormat(url) {
      const urlLower = url.toLowerCase();
      if (urlLower.includes('.m3u8') || urlLower.includes('m3u8')) {
        return 'M3U8 (HLS)';
      } else if (urlLower.includes('.mp4')) {
        return 'MP4';
      } else if (urlLower.includes('.webm')) {
        return 'WebM';
      } else if (urlLower.includes('.ogg') || urlLower.includes('.ogv')) {
        return 'OGG';
      } else if (urlLower.includes('.mov')) {
        return 'MOV';
      } else if (urlLower.includes('.avi')) {
        return 'AVI';
      } else if (urlLower.includes('.mkv')) {
        return 'MKV';
      } else if (urlLower.includes('.flv')) {
        return 'FLV';
      }
      return 'è‡ªåŠ¨æ£€æµ‹';
    }

    // åŠ è½½è§†é¢‘
    function loadVideo(url) {
      if (!url || url.trim() === '') {
        showToast('âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„è§†é¢‘åœ°å€');
        return;
      }

      // æ¸…ç†ä¹‹å‰çš„ HLS å®ä¾‹
      if (hlsInstance) {
        hlsInstance.destroy();
        hlsInstance = null;
      }

      const format = detectFormat(url);
      const isHLS = url.toLowerCase().includes('m3u8');

      // æ›´æ–°ä¿¡æ¯æ˜¾ç¤º
      infoSection.classList.add('show');
      currentUrlSpan.textContent = url.length > 60 ? url.substring(0, 60) + '...' : url;
      videoFormatSpan.textContent = format;
      playStatusSpan.textContent = 'åŠ è½½ä¸­...';

      try {
        if (isHLS) {
          // M3U8 æ ¼å¼ä½¿ç”¨ HLS.js
          if (Hls.isSupported()) {
            hlsInstance = new Hls({
              enableWorker: true,
              lowLatencyMode: true,
              backBufferLength: 90
            });

            hlsInstance.loadSource(url);
            hlsInstance.attachMedia(videoElement);

            hlsInstance.on(Hls.Events.MANIFEST_PARSED, function() {
              showToast('âœ… HLS æµåŠ è½½æˆåŠŸ');
              playStatusSpan.textContent = 'å·²åŠ è½½';
              videoElement.play().catch(e => {
                console.log('è‡ªåŠ¨æ’­æ”¾å—é™:', e);
                showToast('â„¹ï¸ è¯·ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¼€å§‹è§‚çœ‹');
              });
            });

            hlsInstance.on(Hls.Events.ERROR, function(event, data) {
              if (data.fatal) {
                console.error('HLS é”™è¯¯:', data);
                switch(data.type) {
                  case Hls.ErrorTypes.NETWORK_ERROR:
                    showToast('âŒ ç½‘ç»œé”™è¯¯ï¼Œå°è¯•æ¢å¤...');
                    hlsInstance.startLoad();
                    break;
                  case Hls.ErrorTypes.MEDIA_ERROR:
                    showToast('âŒ åª’ä½“é”™è¯¯ï¼Œå°è¯•æ¢å¤...');
                    hlsInstance.recoverMediaError();
                    break;
                  default:
                    showToast('âŒ æ’­æ”¾é”™è¯¯ï¼Œè¯·æ£€æŸ¥è§†é¢‘åœ°å€');
                    playStatusSpan.textContent = 'åŠ è½½å¤±è´¥';
                    break;
                }
              }
            });

          } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
            // Safari åŸç”Ÿæ”¯æŒ HLS
            videoElement.src = url;
            showToast('âœ… ä½¿ç”¨åŸç”Ÿ HLS æ”¯æŒ');
            videoElement.play().catch(e => {
              console.log('è‡ªåŠ¨æ’­æ”¾å—é™:', e);
            });
          } else {
            showToast('âŒ å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ HLS æ’­æ”¾');
          }
        } else {
          // å…¶ä»–æ ¼å¼ç›´æ¥ä½¿ç”¨ HTML5 video
          videoElement.src = url;
          showToast('âœ… è§†é¢‘åŠ è½½ä¸­...');
          
          videoElement.addEventListener('loadedmetadata', function() {
            playStatusSpan.textContent = 'å·²åŠ è½½';
            showToast('âœ… è§†é¢‘å·²å°±ç»ª');
          }, { once: true });

          videoElement.addEventListener('error', function(e) {
            console.error('è§†é¢‘åŠ è½½é”™è¯¯:', e);
            showToast('âŒ è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥åœ°å€æˆ–æ ¼å¼');
            playStatusSpan.textContent = 'åŠ è½½å¤±è´¥';
          }, { once: true });

          videoElement.play().catch(e => {
            console.log('è‡ªåŠ¨æ’­æ”¾å—é™:', e);
          });
        }

      } catch (error) {
        console.error('åŠ è½½é”™è¯¯:', error);
        showToast('âŒ åŠ è½½å¤±è´¥ï¼š' + error.message);
        playStatusSpan.textContent = 'åŠ è½½å¤±è´¥';
      }
    }

    // ä» URL å‚æ•°è·å–è§†é¢‘åœ°å€
    function getVideoFromURL() {
      const params = new URLSearchParams(window.location.search);
      const url = params.get('url');
      if (url) {
        urlInput.value = decodeURIComponent(url);
        loadVideo(url);
      }
    }

    // äº‹ä»¶ç›‘å¬
    loadBtn.addEventListener('click', () => {
      const url = urlInput.value.trim();
      loadVideo(url);
    });

    urlInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const url = urlInput.value.trim();
        loadVideo(url);
      }
    });

    // æ’­æ”¾çŠ¶æ€ç›‘å¬
    videoElement.addEventListener('play', () => {
      playStatusSpan.textContent = 'æ’­æ”¾ä¸­';
    });

    videoElement.addEventListener('pause', () => {
      playStatusSpan.textContent = 'å·²æš‚åœ';
    });

    videoElement.addEventListener('ended', () => {
      playStatusSpan.textContent = 'æ’­æ”¾å®Œæ¯•';
    });

    // é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', (e) => {
      // å¦‚æœç„¦ç‚¹åœ¨è¾“å…¥æ¡†ï¼Œä¸è§¦å‘å¿«æ·é”®
      if (document.activeElement === urlInput) return;

      switch(e.key) {
        case ' ':
          e.preventDefault();
          if (videoElement.paused) {
            videoElement.play();
            showToast('â–¶ æ’­æ”¾');
          } else {
            videoElement.pause();
            showToast('â¸ æš‚åœ');
          }
          break;
        case 'ArrowLeft':
          e.preventDefault();
          videoElement.currentTime = Math.max(0, videoElement.currentTime - 5);
          showToast('âª å¿«é€€ 5ç§’');
          break;
        case 'ArrowRight':
          e.preventDefault();
          videoElement.currentTime = Math.min(videoElement.duration, videoElement.currentTime + 5);
          showToast('â© å¿«è¿› 5ç§’');
          break;
        case 'ArrowUp':
          e.preventDefault();
          videoElement.volume = Math.min(1, videoElement.volume + 0.1);
          showToast('ğŸ”Š éŸ³é‡: ' + Math.round(videoElement.volume * 100) + '%');
          break;
        case 'ArrowDown':
          e.preventDefault();
          videoElement.volume = Math.max(0, videoElement.volume - 0.1);
          showToast('ğŸ”‰ éŸ³é‡: ' + Math.round(videoElement.volume * 100) + '%');
          break;
        case 'f':
        case 'F':
          e.preventDefault();
          if (!document.fullscreenElement) {
            videoElement.requestFullscreen();
            showToast('â›¶ å…¨å±æ¨¡å¼');
          } else {
            document.exitFullscreen();
            showToast('â›¶ é€€å‡ºå…¨å±');
          }
          break;
        case 'm':
        case 'M':
          e.preventDefault();
          videoElement.muted = !videoElement.muted;
          showToast(videoElement.muted ? 'ğŸ”‡ é™éŸ³' : 'ğŸ”Š å–æ¶ˆé™éŸ³');
          break;
      }
    });

    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ URL å‚æ•°
    window.addEventListener('DOMContentLoaded', getVideoFromURL);

  </script>
</body>
</html>
