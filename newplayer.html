<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="referrer" content="no-referrer">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>今晚看什么 - 播放器</title>
  <link rel="shortcut icon" href="https://jyjdsg.dpdns.org/favicon.ico">
  <!-- Artplayer CSS -->
  <link rel="stylesheet" href="https://unpkg.com/artplayer/dist/artplayer.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      background: #000;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    #artplayer {
      width: 100%;
      height: 100%;
    }
    .art-notice {
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div id="artplayer"></div>

  <!-- Hls.js for HLS support -->
  <script src="https://unpkg.com/hls.js@latest/dist/hls.min.js"></script>
  <!-- Artplayer -->
  <script src="https://unpkg.com/artplayer/dist/artplayer.js"></script>
  <script>
    // 获取 URL 参数
    function getUrlParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    // 获取文件类型
    function getFileType(url) {
      try {
        const urlObj = new URL(url);
        const pathname = urlObj.pathname.toLowerCase();
        if (pathname.includes('.m3u8')) return 'm3u8';
        if (pathname.includes('.mp4')) return 'mp4';
        if (pathname.includes('.mkv')) return 'mkv';
        if (pathname.includes('.webm')) return 'webm';
        if (pathname.includes('.flv')) return 'flv';
        return 'mp4'; // 默认按 mp4 处理
      } catch {
        return 'mp4';
      }
    }

    // 初始化播放器
    const videoUrl = getUrlParam("url");
    
    if (!videoUrl) {
      document.body.innerHTML = '<div style="color: white; display: flex; align-items: center; justify-content: center; height: 100%; font-size: 20px; text-align: center;">请在网址后添加参数<br>示例: ?url=https://example.com/video.mp4</div>';
    } else {
      const fileType = getFileType(videoUrl);
      
      const art = new Artplayer({
        container: '#artplayer',
        url: videoUrl,
        title: '播放器',
        type: fileType === 'm3u8' ? 'hls' : 'mp4',
        autoplay: true,
        fullscreen: true,
        fullscreenWeb: true,
        pip: true,
        playsInline: true,
        muted: false,
        autoHeight: false,
        contextMenu: [
          {
            html: '刷新',
            click: () => {
              art.notice.show = '刷新中...';
              setTimeout(() => {
                location.reload();
              }, 500);
            }
          }
        ],
        // HLS 配置
        customType: {
          hls: function(video, url) {
            const hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
              video.play();
            });
            hls.on(Hls.Events.ERROR, (event, data) => {
              if (data.fatal) {
                switch(data.type) {
                  case Hls.ErrorTypes.NETWORK_ERROR:
                    console.warn('网络错误，重新连接中...');
                    hls.startLoad();
                    break;
                  case Hls.ErrorTypes.MEDIA_ERROR:
                    console.warn('媒体错误，尝试恢复...');
                    hls.recoverMediaError();
                    break;
                  default:
                    hls.destroy();
                    art.notice.show = '加载失败，请刷新重试';
                    break;
                }
              }
            });
          }
        },
        // 播放器事件
        events: {
          ready: () => {
            art.notice.show = '✓ 已就绪';
            setTimeout(() => {
              art.notice.show = '';
            }, 2000);
          },
          play: () => {
            art.notice.show = '▶ 播放中...';
            setTimeout(() => {
              art.notice.show = '';
            }, 1000);
          },
          pause: () => {
            art.notice.show = '⏸ 已暂停';
          },
          error: (error) => {
            console.error('播放错误:', error);
            art.notice.show = '❌ 播放失败，请检查链接';
          }
        }
      });

      // 键盘快捷键
      document.addEventListener('keydown', (e) => {
        switch(e.key.toLowerCase()) {
          case 'f':
            art.fullscreen = !art.fullscreen;
            break;
          case ' ':
            e.preventDefault();
            art.playing ? art.pause() : art.play();
            break;
          case 'arrowright':
            art.currentTime += 10;
            break;
          case 'arrowleft':
            art.currentTime -= 10;
            break;
          case 'arrowup':
            e.preventDefault();
            art.volume = Math.min(1, art.volume + 0.1);
            break;
          case 'arrowdown':
            e.preventDefault();
            art.volume = Math.max(0, art.volume - 0.1);
            break;
          case 'm':
            art.muted = !art.muted;
            break;
        }
      });
      });
    }
  </script>
</body>
</html>
</body>
</html>
