<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>今晚看什么</title>
  <link rel="shortcut icon" href="https://jyjdsg.dpdns.org/favicon.ico">
  <link href="https://vjs.zencdn.net/8.23.4/video-js.css" rel="stylesheet" />
  <style>
    html, body {
      margin: 0;
      background: #000;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #my-video {
      width: 100vw;
      height: 100vh;
    }
    .video-js {
      background-color: #000;
    }
  </style>
</head>
<body>

  <video
    id="my-video"
    class="video-js"
    controls
    autoplay
    playsinline
    preload="auto"
    data-setup="{}"
  >
    <p class="vjs-no-js">
      需要启用 JavaScript 或升级到支持 HTML5 video 的浏览器
    </p>
  </video>

  <script src="https://vjs.zencdn.net/8.23.4/video.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="player/dash.all.min.js"></script>
  <script>
    function getUrlParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    const videoUrl = getUrlParam("url");
    if (!videoUrl) {
      alert("请在网址后添加 ?url=视频地址");
    } else {
      // 初始化 video.js 播放器
      const player = videojs('my-video', {
        controlBar: {
          fullscreenToggle: true
        }
      });

      // 检测视频格式
      const urlObj = new URL(videoUrl, window.location.href);
      const path = urlObj.pathname.toLowerCase();
      
      if (path.endsWith('.m3u8')) {
        // 对于 HLS，使用 hls.js 插件
        if (Hls.isSupported()) {
          const hls = new Hls();
          player.src({ src: videoUrl, type: 'application/x-mpegURL' });
          hls.loadSource(videoUrl);
          hls.attachMedia(player.tech().el());
        } else {
          player.src({ src: videoUrl, type: 'application/x-mpegURL' });
        }
      } else if (path.endsWith('.mpd')) {
        player.src({ src: videoUrl, type: 'application/dash+xml' });
      } else if (path.endsWith('.webm')) {
        player.src({ src: videoUrl, type: 'video/webm' });
      } else if (path.endsWith('.ogg')) {
        player.src({ src: videoUrl, type: 'video/ogg' });
      } else {
        // 默认作为 mp4 尝试
        player.src({ src: videoUrl, type: 'video/mp4' });
      }

      // 播放并尝试进入全屏
      player.ready(() => {
        player.play().catch(() => {
          console.warn('自动播放被浏览器阻止');
        });
        
        // 尝试进入全屏
        if (player.requestFullscreen) {
          player.requestFullscreen().catch(() => {});
        }
      });

      // 错误处理
      player.on('error', () => {
        const err = player.error();
        if (err) {
          console.error('播放器错误:', err.code, err.message);
          alert('媒体播放错误: ' + err.message);
        }
      });

      // 添加快捷键功能
      document.addEventListener('keydown', function(event) {
        switch(event.key) {
          case 'ArrowRight':
            player.currentTime(Math.min(player.currentTime() + 10, player.duration()));
            break;
          case 'ArrowLeft':
            player.currentTime(Math.max(player.currentTime() - 10, 0));
            break;
          case ' ':
            event.preventDefault();
            if (player.paused()) {
              player.play();
            } else {
              player.pause();
            }
            break;
        }
      });
    }
  </script>
</body>
</html>